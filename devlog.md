# HackerMystery Development Log

## Project Overview
A 1990s hacker-themed adventure game with a hybrid terminal/windowed interface reminiscent of early Macintosh computers and the movie "Hackers" (1995). Built with Enyo 1 framework for compatibility with webOS devices and modern browsers.

**Target Platforms:**
- webOS/LuneOS tablets and phones (legacy WebKit ~Safari 5-6 era)
- Modern browsers (Chrome, Firefox, Safari)
- Android (via Cordova wrapper)

**Technical Constraints:**
- ES5 JavaScript only (no let/const, arrow functions, etc.)
- Simple CSS (no flexbox, grid, CSS variables)
- Must work offline with optional online features

---

## Milestone 1: Playable Shell

**Status:** Complete
**Date:** December 6, 2024

### Features Implemented

#### Core UI Components
- **Desktop** (`source/ui/Desktop.js`)
  - Icon grid with double-tap to launch programs
  - CSS-based terminal icon fallback (no image required)

- **Window** (`source/ui/Window.js`)
  - Draggable Mac-style windows with touch support
  - Title bar with horizontal stripes
  - Close button

- **WindowManager** (`source/ui/WindowManager.js`)
  - Z-order management (tap to bring to front)
  - Window positioning with cascade offset
  - Open/close lifecycle

- **Terminal** (`source/ui/Terminal.js`)
  - Command input with history (up/down arrows)
  - Typewriter effect for output
  - Built-in commands: help, clear, echo, whoami, date, about, save, load

#### Core Systems
- **GameState** (`source/core/GameState.js`)
  - Singleton state manager
  - Tracks inventory, flags, unlocked programs, command history
  - JSON serialization for save/load

- **SaveManager** (`source/core/SaveManager.js`)
  - Abstracted save/load system (currently localStorage)
  - 10 save slots (0-9)
  - Ready for future server-side save implementation
  - Methods to replace: `_saveToStorage()`, `_loadFromStorage()`

#### Styling
- **Retro CSS** (`css/retro.css`)
  - 1-bit Mac aesthetic (black/white window chrome)
    - This didn't work well on modern screens, need to think about how to do it better
  - Green-on-black terminal display
  - Bold 14px monospace text for readability on older displays

### Cross-Browser Compatibility Lessons Learned

1. **CSS Gradients don't work on old WebKit**
   - Solution: Use tiled data URI GIF/PNG images instead
   - Use `@supports` to provide gradient override for modern browsers

2. **CSS Transforms need -webkit- prefix**
   - Always include both `-webkit-transform` and `transform`

3. **CSS calc() needs -webkit- prefix**
   - Use `-webkit-calc()` for old Safari

4. **Multiple box-shadows may not work on old WebKit**
   - Fallback to background images or pseudo-elements

5. **Vertical alignment in inputs**
   - Use `line-height` and `vertical-align: middle`
   - May need `@supports` for browser-specific margin tweaks

### File Structure
```
enyo-app/
├── depends.js              # Dependency loader
├── index.html              # Entry point
├── appinfo.json            # App metadata
├── source/
│   ├── App.js              # Main application
│   ├── core/
│   │   ├── GameState.js    # State management
│   │   └── SaveManager.js  # Save/load system
│   └── ui/
│       ├── Desktop.js      # Desktop with icons
│       ├── Window.js       # Draggable window
│       ├── WindowManager.js # Window lifecycle
│       └── Terminal.js     # Terminal emulator
├── css/
│   ├── game.css            # Core layout
│   └── retro.css           # Retro Mac styling
└── images/
    ├── icons/              # (placeholder for icons)
    └── ui/                 # (placeholder for UI assets)
```

### Terminal Commands
| Command | Description |
|---------|-------------|
| help | Show available commands |
| clear | Clear the terminal |
| echo [text] | Print text to terminal |
| whoami | Display current user |
| date | Show current date and time |
| about | About this system |
| save [0-9] | Save game to slot |
| load [0-9] | Load game from slot |

---

## Milestone 2: Core Programs

**Status:** Complete
**Date:** December 6, 2024

### Branding
- Renamed game to "Hacker Mystery 95"
- New app icon generated by Gemini Nano Banana image model

### Features Implemented

#### Menu Bar (`source/ui/MenuBar.js`)
- Mac-style persistent menu bar at top of screen
- **Hacker Mystery 95 menu**: About dialog
- **File menu**: Save Game, Load Game
- **View menu**: Show Hidden Files toggle (context-sensitive, only for FileViewer)
- Checkmark indicator for toggled options (using √ for old device compatibility)
- Touch-friendly event handling with old WebKit compatibility

#### Window Focus Indication
- Title bar stripes only appear on focused window
- Unfocused windows have plain white title bars
- Focus updates on window click, close, and z-order changes

#### Alert Modal System
- Reusable modal dialog in App.js
- Used for: About dialog, Save/Load confirmations, Network locked message

#### Virtual Filesystem (`source/data/FileSystem.js`)
- Singleton pattern for global access
- Tree structure with folders and files
- File types: text, folder, encrypted
- Support for locked files (unlock with game flags)
- Support for hidden files/folders
- Encrypted files with password protection and decrypted content
- Chapter 1 story content integrated:
  - `/home/readme.txt` - Initial hook
  - `/home/documents/` - Manifesto, notes pointing to Acid Burn
  - `/home/logs/` - System and connection logs with BBS hints
  - `/home/trash/` - Deleted email about Project GIBSON, password fragment
  - `/home/secrets/` - Hidden folder with encrypted secrets and BBS list

#### File Viewer (`source/programs/FileViewer.js`)
- Finder-style icon grid layout
- Double-tap to open files/folders
- Path bar showing current location
- Visual indicators for locked/hidden files
- Parent folder navigation (..)
- Fires `onOpenFile` event to open files in TextEditor

#### Text Editor (`source/programs/TextEditor.js`)
- View text files from the virtual filesystem
- Info bar with filename
- Scrollable content area
- Password prompt for encrypted files
- Sets game flags when files are decrypted
- HTML-escaped content for security

#### Desktop Updates
- Added Files icon (folder-style)
- Added Network icon (locked/disabled)
- CSS-based icons for all desktop items

#### Window System Updates
- `contentOptions` support for passing data to window content
- Event forwarding from content to App (e.g., `onOpenFile`)

### Story Progression (Chapter 1)
1. Player starts with Terminal auto-launched
2. Opens Files from Desktop icon
3. Explores `/home/readme.txt` - mysterious message from "X"
4. Finds `/home/documents/notes.txt` - learns about Acid Burn and BBS
5. Checks `/home/trash/fragment.txt` - discovers password "hackers"
6. Finds `/home/secrets/` folder (hidden, needs discovery)
7. Opens `too_many_secrets.enc` - uses password to decrypt
8. Learns about Project GIBSON and need to find Acid Burn on BBS

### Updated File Structure
```
enyo-app/
├── source/
│   ├── App.js              # Main app with menu handling, alerts
│   ├── core/
│   │   ├── GameState.js    # Singleton state manager
│   │   └── SaveManager.js  # localStorage save/load (sync + async APIs)
│   ├── data/
│   │   └── FileSystem.js   # Virtual filesystem with hidden files
│   ├── programs/
│   │   ├── FileViewer.js   # Icon-grid file browser with Show Hidden
│   │   └── TextEditor.js   # Text file viewer with encryption support
│   └── ui/
│       ├── Desktop.js      # Desktop with Files, Network, Terminal icons
│       ├── MenuBar.js      # NEW: Mac-style menu bar
│       ├── Window.js       # Draggable windows with focus indication
│       ├── WindowManager.js # Z-order and focus management
│       └── Terminal.js     # Terminal emulator
├── css/
│   └── retro.css           # Retro Mac styling including menu bar
└── images/
    ├── icon.png            # App icon (Gemini Nano Banana)
    └── dither.gif          # Desktop background pattern
```

### Bug Fixes & Improvements
- Fixed desktop icons not responding to clicks (manual DOM event binding)
- Fixed FileViewer appending content instead of replacing on navigation
- Fixed window contentOptions not passing through to content components
- Fixed menu dropdowns closing immediately on touch devices
- Fixed z-index stacking for menu dropdowns vs overlay
- Added synchronous `saveGame()`/`loadGame()` convenience methods to SaveManager
- Added a beautiful icon for the game, thanks to Nano Banana.
- Named the game "Hacker Mystery 95"

### Technical Lessons Learned

#### Event Handling on Old WebKit
- Enyo's onclick handlers can conflict with manual DOM event bindings
- Solution: Use only manual DOM bindings in `rendered()` for complex interactive components
- Always include old browser fallbacks:
  ```javascript
  e = e || window.event;
  e.preventDefault ? e.preventDefault() : e.returnValue = false;
  e.stopPropagation ? e.stopPropagation() : e.cancelBubble = true;
  ```

#### Character Compatibility
- Avoid Unicode characters outside basic Latin (U+0000-U+00FF)
- Use √ (U+221A) instead of ✓ (U+2713) for checkmarks
- Old devices may not render newer Unicode symbols

#### Component Ownership in Enyo
- When using `createComponent()`, the `owner` property determines which component's `this.$` hash contains the new component
- Components owned by a parent aren't destroyed when calling `destroyComponents()` on a container
- Solution: Track dynamically created components in an array and destroy manually

---

## Milestone 3: Puzzle Foundation

**Status:** Complete
**Date:** December 7, 2024

### Features Implemented

#### Puzzle Engine (`source/core/PuzzleEngine.js`)
- Singleton pattern for global access
- Puzzle states: `locked`, `available`, `completed`
- Register puzzles with:
  - Required flags (prerequisites)
  - Completion flags (triggers)
  - Rewards (flags to set, puzzles to unlock)
- Event system for puzzle completion listeners
- Chapter progress tracking
- Auto-completion chains (completing one puzzle can unlock others)

#### Chapter 1 Puzzles Registered
| Puzzle ID | Name | Trigger |
|-----------|------|---------|
| `decrypt_secrets` | Too Many Secrets | Decrypt the encrypted file |
| `find_acid_burn` | Finding Acid Burn | Contact Acid Burn on BBS |
| `chapter1_complete` | Chapter 1 Complete | Gain Acid Burn's trust |

#### BBS System (Terminal-based)
Instead of a separate Email Client, email is integrated into the BBS systems accessed via the terminal - true to the 1995 experience.

**BBSData** (`source/data/BBSData.js`)
- Data definitions for all BBS systems
- Message boards with conditional visibility
- Email system with flag-based message unlocking
- Reply system with trigger words

**BBSHandler** (`source/core/BBSHandler.js`)
- Session state machine (password, main menu, boards, email, etc.)
- Menu navigation (boards, email, who's online, help)
- Message board browsing
- Email inbox with read/unread tracking
- Reply composition with trigger-word detection
- Automatic flag setting on story progression

#### BBS Systems
| Phone | Name | Status | Notes |
|-------|------|--------|-------|
| 555-0199 | The Underground | Active | Password protected, main story BBS |
| 555-0134 | CyberDen | Banned | Player is banned |
| 555-2176 | PhreakHole | Dead | Shut down by feds |
| 555-0200 | The Gibson Files | Locked | Future content |

#### Terminal Updates
- New commands: `dial <number>`, `hangup`
- BBS session routing (input goes to BBSHandler when connected)
- Password prompt mode
- "Press any key" handling for menus

#### TextEditor Integration
- Notifies PuzzleEngine when files are decrypted
- Consistent flag naming (strips file extension)

### Story Progression (Chapter 1 Complete)
1. Player explores filesystem, finds hints about BBS
2. Discovers password "hackers" in trash folder
3. Decrypts `too_many_secrets.enc` - learns about GIBSON
4. Uses terminal: `dial 555-0199` to connect to The Underground
5. Enters password "hackers"
6. Checks Email - finds message from Acid Burn
7. Replies with "GIBSON" to prove legitimacy
8. Gains Acid Burn's trust, unlocks Elite board
9. Chapter 1 complete!

### Updated File Structure
```
enyo-app/
├── source/
│   ├── App.js
│   ├── core/
│   │   ├── GameState.js
│   │   ├── SaveManager.js
│   │   ├── PuzzleEngine.js    # NEW: Puzzle management
│   │   └── BBSHandler.js      # NEW: BBS session handler
│   ├── data/
│   │   ├── FileSystem.js
│   │   └── BBSData.js         # NEW: BBS content data
│   ├── programs/
│   │   ├── FileViewer.js
│   │   └── TextEditor.js      # Updated: PuzzleEngine integration
│   └── ui/
│       ├── Desktop.js
│       ├── MenuBar.js
│       ├── Window.js
│       ├── WindowManager.js
│       └── Terminal.js        # Updated: BBS commands
```

### New Terminal Commands
| Command | Description |
|---------|-------------|
| dial [number] | Dial a BBS (e.g., dial 555-0199) |
| hangup | Disconnect from current BBS |

---

## Notes

### Testing on webOS
- Use nginx with proper permissions for local development
- Ensure `_www` user has execute permission on all parent directories
- nginx config requires trailing slashes when using `alias` directive

### Building
```bash
# webOS/LuneOS
./build.sh webos

# Web
./build.sh www

# Android
./build.sh android
```
